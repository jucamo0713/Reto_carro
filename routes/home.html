<!DOCTYPE html>

<html lang="es">
<!--
<head>
    <meta charset="utf-8">
    <title>Curso JavaScript aprenderaprogramar.com</title>

    <script type="text/javascript">

        function iniciar() {

            var boton = document.getElementById('obtener');

            boton.addEventListener('click', obtener, false);

        }



        function obtener() { navigator.geolocation.getCurrentPosition(mostrar, gestionarErrores); }



        function mostrar(posicion) {

            var ubicacion = document.getElementById('localizacion');

            var datos = '';

            datos += 'Latitud: ' + posicion.coords.latitude + '<br>';

            datos += 'Longitud: ' + posicion.coords.longitude + '<br>';

            datos += 'Exactitud: ' + posicion.coords.accuracy + ' metros.<br>';

            ubicacion.innerHTML = datos;

        }



        function gestionarErrores(error) {

            alert('Error: ' + error.code + ' ' + error.message + '\n\nPor favor compruebe que está conectado ' +

                'a internet y habilite la opción permitir compartir ubicación física');

        }



        window.addEventListener('load', iniciar, false);



    </script>

</head>

<body>

    <div id="localizacion">

        <button id="obtener" style="margin:30px;">Obtener mi localización</button>

    </div>

</body>
-->

<head>
    <title>Simple Map</title>

    <meta charset="utf-8">
    <title>Curso JavaScript aprenderaprogramar.com</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBawixDb7I5u7qT7hlkP0w4WYzMCnG7IhY&callback=initMap&libraries=&v=weekly"
        defer></script>
    <style>
        * {
            font-family: sans-serif;
        }

        h1 {
            margin: 150px 0 30px 0;
            text-align: center;
        }

        #lienzoMapa {
            width: 800px;
            height: 600px;
            margin: 0 auto;
            border: 5px solid;
        }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script type="text/javascript">

        function iniciar() {
            obtener();

        }



        function obtener() { navigator.geolocation.getCurrentPosition(mostrar, gestionarErrores); }



        function mostrar(posicion) {
            console.log(posicion);
            var datos = '';
            initialize(posicion.coords.latitude, posicion.coords.longitude);

        }



        function gestionarErrores(error) {

            alert('Error: ' + error.code + ' ' + error.message + '\n\nPor favor compruebe que está conectado ' +

                'a internet y habilite la opción permitir compartir ubicación física');

        }



        window.addEventListener('load', iniciar, false);

        var map;

        function initialize(lat, long) {
            const myLatlng = { lat: lat, lng: long };
            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer();
            var mapOptions = {

                zoom: 15,
                center: new google.maps.LatLng(lat, long)

            };

            const onChangeHandler = function () {
                calculateAndDisplayRoute(directionsService, directionsRenderer, centro, map.getCenter());
            };

            map = new google.maps.Map(document.getElementById('lienzoMapa'), mapOptions);
            let centro = map.getCenter();
            let marker = new google.maps.Marker({
                position: myLatlng,
                map,
                title: "Click to route",
            });
            map.addListener("center_changed", () => {
                marker.setPosition(map.getCenter());
            });
            marker.addListener("click", onChangeHandler);
            directionsRenderer.setMap(map);
        }
        function calculateAndDisplayRoute(directionsService, directionsRenderer, origin, destino) {
            console.log(destino);
            directionsService.route(
                {
                    origin: origin,
                    destination: destino,
                    travelMode: google.maps.TravelMode.DRIVING,
                },
                (response, status) => {
                    console.log(response);
                    if (status === "OK") {
                        directionsRenderer.setDirections(response);
                    } else {
                        window.alert("Directions request failed due to " + status);
                    }
                }
            );
        }

    </script>

</head>

<body>

    <h1>Utiliza el mapa</h1>

    <div id="lienzoMapa"></div>

</body>

</html>